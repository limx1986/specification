#MySQL数据库规范

## 一、基本规范

### 1.1 数据库使用规范

- 使用InnoDB作为表的存储引擎
- 数据库和数据表统一使用UTF8MB4字符编码
- 所有的表和字段必须添加注释
- 不在数据库做运算，务必将运算置于业务层

### 1.2 行为及流程规范

- 禁止在线上做数据库的压力测试
- 禁止在业务高峰期批量更新、查询数据
- 对应的环境使用对应的数据库，比如测试环境一定要使用测试环境的数据库
- super权限只能属于DBA，不能赋予业务方
- 架构评审，活动推广，系统上线以及平台上新务必对流量进行评估
- 所有建表前都要确定字段的类型、长度以及索引方可建表
- 所有对表的结构、数据的修改务必经过DBA的审阅和同意

### 1.3 SQL编写规范

- 编写SQL语句必须全部为大写，每个词必只允许只有一个空格符

## 二、命名规范

### 2.1 基本命名规范

- 对象名称必须使用小写，多单词统一使用下划线分割
- 命名的单词必须做到顾名思义、简洁，表名长度不要超过16个字符，字段名称长度不要超过32个字符
- 禁止使用保留字并且尽量少用含有关键词来命名
- 临时表必须以tmp_开头、以日期结尾，备份表必须以bak_开头、以日期结尾

### 2.2 数据库命名规范

- 数据库

### 2.3 表命名规范

### 2.4 字段命名规范

### 2.5 索引命名规范

## 三、数据库DDL规范

### 3.1 建表规范

- 遵循范式与冗余平衡原则
- 尽可能避免使用外键约束
- 控制每张表的字段在20以内，否则业务分表
- 数据表统一使用UTF8MB4字符编码
- 包含创建时间字段：created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
- 包含修改时间字段：updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP

### 3.2 字段规范

- 禁止使用TEXT、BLOB、ENUM数据类型，禁止存放图片、文件等二进制数据
- 枚举统一使用TINYINT UNSIGNEG存储
- 尽可能将所有的数据列定义为NOT NULL类型
- 使用TIMESTAMP替换DATETIME存储时间
- 金额统一使用INT，单位为分
- 固定长度的字符串字段务必使用CHAR
- 使用UNSIGNEG存储非负整数
- 禁止敏感数据以明文形式存储

### 3.3 

## 四、数据库索引规范

- SQL语句必须带上索引作为条件
- 避免冗余和重复索引
- 禁止在索引列进行数学运算和函数运算
-  符合索引将区分度高的字段置前
- 务必不要在作为查询条件很少、或者没有关联的字段下建立索引
- 尽可能每张表的索引数量控制在5个以内
- 每一张InnoDB表都必须含有一个主键索引
- 

## 五、数据库DML规范

- 禁止使用带有数据值却不带有字段键名的INSERT操作
- 批量DML尽量合并操作减少数据库的交互，但注意合理的批次分布，避免因锁占用影响其他事务。过大的写操作应放在非业务高峰执行
- 使用事务尽量简单化，同时控制事务执行的时间，将事务中行锁占用多的语句放在事务靠后位置执行
- 禁止一条语句同时对多个表进行写操作

## 六、数据库查询规范

- 严禁使用SELECT *
- SQL语句必须带上索引作为条件
- 避免使用JOIN
- 尽可能使用IN代替OR语句
- 禁止在WHERE语句中进行计算
- IN语句参数的个数尽量控制在1000以内
- 注意LIMIT分页查询效率，LIMIT越大效率越低
- 尽可能使用EXIST|NOT EXIST替代IN | NOT IN
- 禁止使用LIKE添加%前缀进行模糊查询
- 

